"use strict";const endpoint_url="http://localhost:9798/frontend/log";function generateSessionId(){let length=20;let sessionId="";let possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<length;i++){sessionId+=possible.charAt(Math.floor(Math.random()*possible.length));}
return sessionId;}
function setCookie(cname,cvalue,exmills){let d=new Date();d.setTime(d.getTime()+exmills);let expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/";}
function getCookie(cname){let name=cname+"=";let ca=document.cookie.split(';');for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)===' '){c=c.substring(1);}
if(c.indexOf(name)===0){return c.substring(name.length,c.length);}}
return"";}
function refreshSessionId(){let timestamp=Date.now();let cookieExpieryTime=(1000*60*5);let sessionId=getCookie("sessionId");let isCookieExpired=(sessionId==="");if(isCookieExpired){setCookie("sessionId",generateSessionId(),cookieExpieryTime);setCookie("timestamp",timestamp,cookieExpieryTime);}
else{setCookie("sessionId",sessionId,cookieExpieryTime);setCookie("timestamp",timestamp,cookieExpieryTime);}}
function post(url,body,headerProperties){let xhr=new XMLHttpRequest();xhr.open('POST',url);for(let key in headerProperties){xhr.setRequestHeader(key,headerProperties[key]);}
xhr.onload=function(){if(xhr.status===200){console.log(xhr.status);}
else{console.log(xhr.status);}};xhr.send(body);}
function simplifyObject(object){let objectJson={"screenX":object["screenX"],"screenY":object["screenY"],"clientX":object["clientX"],"clientY":object["clientY"],"x":object["x"],"y":object["y"],"offsetX":object["offsetX"],"offsetY":object["offsetY"],"movementX":object["movementX"],"movementY":object["movementY"],"layerX":object["layerX"],"layerY":object["layerY"],"type":object["type"],"timeStamp":object["timeStamp"],"offsetTop":object["target"]["offsetTop"],"offsetLeft":object["target"]["offsetLeft"],"offsetWidth":object["target"]["offsetWidth"],"offsetHeight":object["target"]["offsetHeight"],"innerText":object["target"]["innerText"],"outerText":object["target"]["outerText"],"scrollTop":object["target"]["scrollTop"],"scrollLeft":object["target"]["scrollLeft"],"scrollWidth":object["target"]["scrollWidth"],"scrollHeight":object["target"]["scrollHeight"],"clientTop":object["target"]["clientTop"],"clientLeft":object["target"]["clientLeft"],"clientWidth":object["target"]["clientWidth"],"clientHeight":object["target"]["clientHeight"],"value":object["target"]["value"],"srcElementclassName":object["srcElement"]["className"],"srcElementId":object["srcElement"]["id"],"targetclassName":object["target"]["className"],"targetId":object["target"]["id"]};return objectJson;}
function log(event){console.log(event);let simplifiedEvent=simplifyObject(event);let eventJson=JSON.stringify(simplifiedEvent);send_log(eventJson);}
function send_log(log){let url=endpoint_url;let sessionId=getCookie("sessionId");let header={"sessionId":sessionId,"Content-Type":"application/json"};post(url,log,header);}
var delay=(function(){let timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);}})();let logHandler=function(event){refreshSessionId();if(event["type"]==="input"){delay(function(){log(event);},2000);}
else{log(event);}};let eventsToLog=["mousedown","mouseup","input","mouseover"];document.addEventListener("DOMContentLoaded",function(){let target=document.querySelector('body');let observer=new MutationObserver(function(mutations){eventsToLog.forEach(eventToLog=>{document.addEventListener(eventToLog,logHandler);});});let config={attributes:true,childList:true,characterData:true}
observer.observe(target,config);refreshSessionId();});